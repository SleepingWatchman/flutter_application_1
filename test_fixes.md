# –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤

### 1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

**–®–∞–≥–∏:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
3. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —ç–∫—Ä–∞–Ω "–°–æ–≤–º–µ—Å—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞"
4. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–æ–≤–º–µ—Å—Ç–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
5. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω—É—é –±–∞–∑—É
6. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –ù–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏, –Ω–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
7. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –ª–∏—á–Ω—É—é –±–∞–∑—É
8. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –±–µ–∑ —Ü–∏–∫–ª–æ–≤

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–®–∞–≥–∏:**
1. –ù–∞—Ö–æ–¥—è—Å—å –≤ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
2. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ AppBar
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –ù–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –í –ª–æ–≥–∞—Ö –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

**–®–∞–≥–∏:**
1. –°–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–º–µ—Ç–æ–∫ –≤ –ª–∏—á–Ω–æ–π –±–∞–∑–µ
2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–Ω—É—é –±–∞–∑—É
3. –°–æ–∑–¥–∞—Ç—å –∑–∞–º–µ—Ç–∫–∏ –≤ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –±–∞–∑–µ
4. –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –±–∞–∑–∞–º–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: UI –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∑—ã–≤—á–∏–≤—ã–º
6. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –î–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
7. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –ù–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —ç–∫—Ä–∞–Ω–∞

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–®–∞–≥–∏:**
1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Go —Å–µ—Ä–≤–µ—Ä
2. –ü–æ–¥–æ–∂–¥–∞—Ç—å –º–∏–Ω—É—Ç—É (–≤—Ä–µ–º—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏)
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ù–ï –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
5. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é
6. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 5. **–ù–û–í–û–ï: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç 28.05.2024:**
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ HTTP 400 –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ image_data –≤ base64 –≤ `enhanced_sync_service.dart`
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `dart:typed_data` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `Uint8List`
- **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª–µ–Ω –º–∞–ø–∏–Ω–≥ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö ID –ø–∞–ø–æ–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ ID**

**–®–∞–≥–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
1. –ù–∞—Ö–æ–¥—è—Å—å –≤ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
2. –°–æ–∑–¥–∞—Ç—å –∑–∞–º–µ—Ç–∫—É —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
3. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ AppBar
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ HTTP 400 –∏ HTTP 500
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è "–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ base64"
6. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –æ –º–∞–ø–∏–Ω–≥–µ folder_id
7. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –°–µ—Ä–≤–µ—Ä –Ω–µ –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫–∏ FOREIGN KEY constraint failed

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**
```
flutter: –ù–∞—á–∏–Ω–∞–µ–º —Ä—É—á–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: X
flutter: –ó–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è X: XXX –±–∞–π—Ç
flutter: –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ base64, —Ä–∞–∑–º–µ—Ä: XXX –±–∞–π—Ç
flutter: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞: notes=X, folders=X, schedule_entries=X, pinboard_notes=X, connections=X, note_images=X
flutter: –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É: 200
flutter: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ

// –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
Sync: Folder —Å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–º ID X –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –¥–ª—è –ë–î X. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π.
Sync: –£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞ Folder —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º ID X (–∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π ID X) –¥–ª—è –ë–î X
Sync: –ó–∞–º–µ—Ç–∫–∞ ID X, folder_id –∑–∞–º–∞–ø–ª–µ–Ω —Å X –Ω–∞ X
Sync: –£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞ Note —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º ID X (–∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π ID X) –¥–ª—è –ë–î X
```

## –õ–æ–≥–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ (–Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ):**
```
–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö: [ID]
–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö [ID] —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
–û–ø–µ—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
–ù–∞—á–∏–Ω–∞–µ–º —Ä—É—á–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: [ID]
–û–ø–µ—Ä–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
```

**–ù–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ –ª–æ–≥–∏ (—É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã):**
```
–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –±–µ–∑ –∑–∞—â–∏—Ç—ã
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –±–µ–∑ —É—á–∞—Å—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∏–¥–∂–µ—Ç–æ–≤
–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫
```

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–±–∏–ª—å–Ω–æ
‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤—Ä—É—á–Ω—É—é
‚úÖ –ù–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ –≤ –ª–æ–≥–∞—Ö
‚úÖ UI –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∑—ã–≤—á–∏–≤—ã–º
‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ 

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Ü–∏–∫–ª—ã
- –£–±—Ä–∞–Ω—ã –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ `setState()` –≤ `main.dart`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞—Ö
- –û—Ç–∫–ª—é—á–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –±–∞–∑

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –æ—à–∏–±–∫–∞ HTTP 400 –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ base64
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã

### üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–µ–ø–µ—Ä—å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤—Ä—É—á–Ω—É—é (–∫–Ω–æ–ø–∫–∞ –≤ AppBar)
- –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Consumer –≤–∏–¥–∂–µ—Ç—ã
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º 

### 6. **–ù–û–í–ï–ô–®–ï–ï: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ FOREIGN KEY constraint –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–≤–µ—Ä—Å–∏—è –æ—Ç 28.05.2024)**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –º–æ–≥–ª–∏ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏–∑-–∑–∞ —Å—Å—ã–ª–æ–∫ –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–º–µ—Ç–∫–∏
- –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ ID –∑–∞–º–µ—Ç–æ–∫ –Ω–µ –º–∞–ø–∏–ª–∏—Å—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ ID –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –û—à–∏–±–∫–∞: "FOREIGN KEY constraint failed" –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ sync_controller.go:**
- –î–æ–±–∞–≤–ª–µ–Ω –º–∞–ø–∏–Ω–≥ `clientToServerNoteMap` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∏ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö ID –∑–∞–º–µ—Ç–æ–∫
- –ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π note_id –º–∞–ø–∏—Ç—Å—è —Å –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π ID
- –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –º–∞–ø–∏–Ω–≥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### 7. **–ù–û–í–ï–ô–®–ï–ï: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏ —ç–∫—Ä–∞–Ω–æ–≤ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–≤–µ—Ä—Å–∏—è –æ—Ç 28.05.2024)**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –≠–∫—Ä–∞–Ω—ã –Ω–µ –æ—á–∏—â–∞–ª–∏—Å—å –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–µ–∂–¥—É –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
- –î–∞–Ω–Ω—ã–µ –ª–∏—á–Ω–æ–π –±–∞–∑—ã –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –≤–∏–¥–∏–º—ã–º–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–Ω—É—é –±–∞–∑—É
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ø–∞–¥–∞–ª–∏ –≤ —Å–æ–≤–º–µ—Å—Ç–Ω—É—é –±–∞–∑—É –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `clearCache()` –≤ `DatabaseHelper`
- –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `_clearCachedData()` –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –±–∞–∑ –≤ `database_provider.dart`
- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º –±–∞–∑—ã

### 8. **–ù–û–í–ï–ô–®–ï–ï: –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ (–≤–µ—Ä—Å–∏—è –æ—Ç 28.05.2024)**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –¢—Ä–µ–±–æ–≤–∞–ª–æ—Å—å –æ–∂–∏–¥–∞–Ω–∏–µ –¥–æ 1 –º–∏–Ω—É—Ç—ã –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞
- –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –£–º–µ–Ω—å—à–µ–Ω –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ —Å 60 —Å–µ–∫—É–Ω–¥ –¥–æ 10 —Å–µ–∫—É–Ω–¥
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–Ω—É—é –±–∞–∑—É
- –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞

**–®–∞–≥–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –≠–∫—Ä–∞–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞—é—Ç—Å—è –æ—Ç –¥–∞–Ω–Ω—ã—Ö –ª–∏—á–Ω–æ–π –±–∞–∑—ã
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥
4. –°–æ–∑–¥–∞—Ç—å –∑–∞–º–µ—Ç–∫—É —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –≤ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –±–∞–∑–µ
5. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
6. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ FOREIGN KEY
7. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –æ –º–∞–ø–∏–Ω–≥–µ note_id –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
```
// –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
Sync: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ID X, note_id –∑–∞–º–∞–ø–ª–µ–Ω —Å X –Ω–∞ X
Sync: –£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞ NoteImage —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º ID X (–∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π ID X) –¥–ª—è –ë–î X

// –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ:
flutter: –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –±–∞–∑—ã
flutter: –í—ã–ø–æ–ª–Ω—è–µ–º –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞...
flutter: –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–Ω—É—é –±–∞–∑—É
flutter: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
```

# –ñ—É—Ä–Ω–∞–ª –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –æ—à–∏–±–æ–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

## –î–∞—Ç–∞: 28 –º–∞—è 2025

### –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏–∑ –ª–æ–≥–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### 1. **–û—à–∏–±–∫–∏ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–ª–æ–Ω–∫–∏ `database_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `note_images`
  ```
  SqfliteFfiException: no such column: database_id, SQL logic error
  SELECT * FROM note_images WHERE database_id = ?
  ```
- **–ü—Ä–æ–±–ª–µ–º–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–ª–æ–Ω–æ–∫ `created_at` –∏ `updated_at` –≤ —Ç–∞–±–ª–∏—Ü–µ `schedule_entries`
  ```
  SqfliteFfiException: table schedule_entries has no column named created_at
  INSERT OR REPLACE INTO schedule_entries (..., created_at, updated_at) VALUES (...)
  ```

#### 2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –≠–∫—Ä–∞–Ω—ã –∑–∞–≥—Ä—É–∂–∞–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ "–ª–æ–∫–∞–ª—å–Ω–æ–π" –±–∞–∑—ã –¥–∞–∂–µ –≤ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ
  ```
  flutter: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±–∞–∑—ã: –ª–æ–∫–∞–ª—å–Ω–æ–π  // –í —Å–æ–≤–º–µ—Å—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ!
  ```
- **–ü—Ä–∏—á–∏–Ω–∞**: –§–ª–∞–≥ `_isUsingSharedDatabase` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –ø–æ–∑–¥–Ω–æ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è

#### 3. **–ü–æ—Ç–µ—Ä—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—á–µ–∑–∞–ª–∏ –ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
  ```
  flutter: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: image_1748288503051.jpg
  flutter: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ image_1748288503051.jpg –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –≤ –æ–¥–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
  ```

#### 4. **–ù–µ–ø–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ –ª–∏—á–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã–µ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∏—Å—å –ø–æ–ª–Ω–æ—Å—Ç—å—é

### –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** (`lib/db/database_helper.dart`)

**–î–æ–±–∞–≤–ª–µ–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏:**
```sql
-- –í —Ç–∞–±–ª–∏—Ü—É schedule_entries
ALTER TABLE schedule_entries ADD COLUMN created_at TEXT;
ALTER TABLE schedule_entries ADD COLUMN updated_at TEXT;

-- –í —Ç–∞–±–ª–∏—Ü—É note_images  
ALTER TABLE note_images ADD COLUMN database_id TEXT;
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü:**
```sql
CREATE TABLE schedule_entries(
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  time TEXT,
  date TEXT,
  note TEXT,
  dynamic_fields_json TEXT,
  recurrence_json TEXT,
  database_id TEXT,
  created_at TEXT,      -- –î–û–ë–ê–í–õ–ï–ù–û
  updated_at TEXT       -- –î–û–ë–ê–í–õ–ï–ù–û
);

CREATE TABLE IF NOT EXISTS note_images (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  note_id INTEGER NOT NULL,
  file_name TEXT NOT NULL,
  image_data BLOB NOT NULL,
  database_id TEXT,     -- –î–û–ë–ê–í–õ–ï–ù–û
  FOREIGN KEY (note_id) REFERENCES notes (id) ON DELETE CASCADE
);
```

**–£–≤–µ–ª–∏—á–µ–Ω–∞ –≤–µ—Ä—Å–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:** `_dbVersion = 4`

#### 2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö** (`lib/providers/enhanced_collaborative_provider.dart`)

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–æ–≤ –≤ –Ω–∞—á–∞–ª–µ –ø—Ä–æ—Ü–µ—Å—Å–∞:**
```dart
// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥–∏ –ü–ï–†–ï–î –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –±–∞–∑—ã
_currentDatabaseId = databaseId;
_isUsingSharedDatabase = true;

// –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –æ—á–∏—â–∞–µ–º –∫–µ—à –∏ —É–≤–µ–¥–æ–º–ª—è–µ–º –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
print('–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –±–∞–∑—ã');
await _dbHelper.clearCache();
print('–ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω—ã');

// –£–≤–µ–¥–æ–º–ª—è–µ–º –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –°–†–ê–ó–£
notifyListeners();
```

**–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
```dart
// –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ backup
try {
  if (_databaseProvider != null) {
    final personalBackup = await _databaseProvider!.getPersonalBackup();
    if (personalBackup != null) {
      print('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏...');
      await _databaseProvider!.restoreFromBackup(personalBackup, null);
      print('–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');
    }
  }
} catch (e) {
  print('–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: $e');
}
```

#### 3. **–£–ª—É—á—à–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏** (`lib/services/enhanced_sync_service.dart`)

**–í–∞–ª–∏–¥–∞—Ü–∏—è folder_id –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∑–∞–º–µ—Ç–æ–∫:**
```dart
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å folder_id –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º
final folderId = note['folder_id'];
if (folderId != null && folderId != 0) {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–∞–ø–∫–∞ –≤ —Ç–æ–π –∂–µ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
  final folderExists = await db.query(
    'folders', 
    where: 'id = ? AND database_id = ?', 
    whereArgs: [folderId, _currentDatabaseId],
    limit: 1
  );
  
  if (folderExists.isEmpty) {
    print('–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –ó–∞–º–µ—Ç–∫–∞ ${note['id']} —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ø–∞–ø–∫—É $folderId, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º folder_id –≤ null');
    final correctedNote = Map<String, dynamic>.from(note);
    correctedNote['folder_id'] = null;
    changes.add({...correctedNote, 'type': 'note'});
    continue;
  }
}
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è note_id –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
```dart
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å note_id –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º
final noteId = imageData['note_id'];
if (noteId != null && noteId != 0) {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –∑–∞–º–µ—Ç–∫–∞ –≤ —Ç–æ–π –∂–µ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
  final noteExists = await db.query(
    'notes', 
    where: 'id = ? AND database_id = ?', 
    whereArgs: [noteId, _currentDatabaseId],
    limit: 1
  );
  
  if (noteExists.isEmpty) {
    print('–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${image['id']} —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–º–µ—Ç–∫—É $noteId, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º');
    continue;
  }
}
```

#### 4. **–£–ª—É—á—à–µ–Ω–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**

**–î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ–ª–∞–≥–∏ –∑–∞—â–∏—Ç—ã:**
```dart
// –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
if (_isSwitchingDatabase) {
  print('–û–ø–µ—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º');
  return;
}

// –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
if (_isSyncing) {
  print('–û–ø–µ—Ä–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º');
  return;
}
```

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

#### ‚úÖ **–£—Å–ø–µ—à–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö**
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –±–∞–∑—ã
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ

#### ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ FOREIGN KEY constraint
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å —Å–µ—Ä–≤–µ—Ä–∞

#### ‚úÖ **–ù–∞–¥–µ–∂–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

#### ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞**
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –Ø—Å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

**–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–Ω—É—é –±–∞–∑—É
2. –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
4. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –ª–∏—á–Ω—É—é –±–∞–∑—É
5. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å
6. –°–Ω–æ–≤–∞ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–Ω—É—é –±–∞–∑—É
7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–ª–∏—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ —É—Å–ø–µ—à–Ω–æ–π —Ä–∞–±–æ—Ç—ã:**
```
flutter: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö: 5
flutter: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º...
flutter: –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
flutter: –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –±–∞–∑—ã
flutter: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: 5
flutter: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±–∞–∑—ã: 5
flutter: –ù–∞—á–∏–Ω–∞–µ–º —Ä—É—á–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: 5
flutter: –õ–æ–∫–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π: 2
flutter: –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π: 2
flutter: –ü–æ–ª—É—á–µ–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å —Å–µ—Ä–≤–µ—Ä–∞: 2
flutter: –ö–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏: 0
flutter: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: 4 —ç–ª–µ–º–µ–Ω—Ç–æ–≤, 0 –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
flutter: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ª–∏—á–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
flutter: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏...
flutter: –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
flutter: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±–∞–∑—ã: –ª–æ–∫–∞–ª—å–Ω–æ–π
```

### –°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- ‚úÖ **–°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é
- ‚úÖ **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é  
- ‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é
- ‚úÖ **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π 

# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ Flutter –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º
–í —Ö–æ–¥–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±—ã–ª–∏ –≤—ã—è–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

1. **–û—à–∏–±–∫–∏ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** - –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏ `database_id` –∏ `created_at/updated_at`
2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö** - –ø–æ–∫–∞–∑ "–ª–æ–∫–∞–ª—å–Ω–æ–π" –±–∞–∑—ã –≤ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ
3. **–ü–æ—Ç–µ—Ä—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
4. **–ù–µ–ø–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É
5. **–î–≤–æ–π–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–µ—Ä–≤–µ—Ä—É
6. **–ù–û–í–û–ï: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–Ω—É—é –±–∞–∑—É

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (28.05.2025)

### –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑-–∑–∞:
- –î–æ–ª–≥–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ `database_provider.dart`
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ `_loadData()` –≤ —ç–∫—Ä–∞–Ω–∞—Ö
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- –ü–æ–≤—Ç–æ—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ `lib/providers/database_provider.dart`

#### 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è `initializeSharedDatabase()`
```dart
// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–±–∏—Ä–∞–µ–º –¥–æ–ª–≥–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
try {
  await _dbHelper.initializeSharedDatabase(databaseId);
  print('–°–æ–≤–º–µ—Å—Ç–Ω–∞—è –±–∞–∑–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ DatabaseHelper');
} catch (e) {
  print('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ DatabaseHelper: $e');
  // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
}

// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
if (_currentDatabaseId == null) {
  // –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
}
```

#### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è `switchToDatabase()`
```dart
// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –¢–û–õ–¨–ö–û –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –° —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –ù–ê –ª–∏—á–Ω—É—é
if (_currentDatabaseId != null && databaseId == null) {
  // –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –Ω—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ
} else {
  print('–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è');
}

// –ù–ï –ø–µ—Ä–µ–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏—è, —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ `lib/providers/enhanced_collaborative_provider.dart`

#### 1. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ `switchToDatabase()`
```dart
// –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ —Ç—É –∂–µ –±–∞–∑—É
if (_currentDatabaseId == databaseId && _isUsingSharedDatabase) {
  print('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö $databaseId —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ');
  return;
}

// –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥–∏ –ù–ï–ú–ï–î–õ–ï–ù–ù–û
_currentDatabaseId = databaseId;
_isUsingSharedDatabase = true;

// –£–≤–µ–¥–æ–º–ª—è–µ–º –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –°–†–ê–ó–£
notifyListeners();
```

#### 2. –ë—ã—Å—Ç—Ä–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
```dart
// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –ë–ï–ó –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
await _dbHelper.clearCache();
print('–ö–µ—à —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω');
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ `lib/db/database_helper.dart`

#### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è `initializeSharedDatabase()`
```dart
// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –¥–æ–ª–≥–∏—Ö timeouts
final db = await database;

// –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π
final existing = await db.query(
  'shared_databases',
  where: 'server_id = ?',
  whereArgs: [databaseId],
  limit: 1,
);

if (existing.isEmpty) {
  // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –ë–ï–ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
  try {
    await db.insert('shared_databases', {
      'server_id': databaseId,
      'name': 'Shared Database $databaseId',
      // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
    });
  } catch (e) {
    print('–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏: $e');
    // –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
  }
}
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ —ç–∫—Ä–∞–Ω–∞—Ö (notes_screen.dart, schedule_screen.dart)

#### 1. –ó–∞—â–∏—Ç–∞ –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫
```dart
bool _isLoading = false;
bool _isDataLoaded = false; // –§–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫
String? _lastLoadedDatabaseId; // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –±–∞–∑—ã

// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫
if (_isLoading) {
  print('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º');
  return;
}
```

#### 2. –£—Å–ª–æ–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```dart
// –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
void _loadDataIfNeeded() {
  final collabProvider = Provider.of<CollaborativeDatabaseProvider>(context, listen: false);
  final currentDatabaseId = collabProvider.isUsingSharedDatabase 
      ? collabProvider.currentDatabaseId 
      : null;
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±–∞–∑–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
  if (!_isDataLoaded || _lastLoadedDatabaseId != currentDatabaseId) {
    _loadData();
  }
}
```

#### 3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
```dart
void _handleDatabaseChanges() {
  if (mounted) {
    print('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞ –∏–∑-–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö');
    _loadDataIfNeeded(); // –í–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ _loadData()
  }
}
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** - –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ –±–µ–∑ –¥–æ–ª–≥–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
2. **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω—ã –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏** - –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏** - —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ
4. **–£–ª—É—á—à–µ–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è** –º–µ–∂–¥—É –ª–∏—á–Ω–æ–π –∏ —Å–æ–≤–º–µ—Å—Ç–Ω—ã–º–∏ –±–∞–∑–∞–º–∏
5. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** - –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: `cd NotesServerGO && go run main.go`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Flutter –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±—ã—Å—Ç—Ä–æ –±–µ–∑ –∑–∞–≤–∏—Å–∞–Ω–∏—è
5. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –±–∞–∑–µ
6. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –ª–∏—á–Ω—É—é –±–∞–∑—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

## –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏

–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–Ω—É—é –±–∞–∑—É:
```
flutter: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö: 5
flutter: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º...
flutter: –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞
flutter: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∑–∞–∫—Ä—ã—Ç–∞
flutter: –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –±–∞–∑—ã
flutter: –ö–µ—à —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω
flutter: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: 5
flutter: –°–æ–≤–º–µ—Å—Ç–Ω–∞—è –±–∞–∑–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ DatabaseHelper
flutter: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
flutter: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±–∞–∑—ã: 5
```

–ë–µ–∑ –æ—à–∏–±–æ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏.

---

## –ü—Ä–µ–¥—ã–¥—É—â–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (`lib/db/database_helper.dart`)

#### –ü—Ä–æ–±–ª–µ–º–∞
```
SqfliteFfiException: no such column: database_id, SQL logic error
SqfliteFfiException: table schedule_entries has no column named created_at
```

#### –†–µ—à–µ–Ω–∏–µ
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ `database_id TEXT` –≤ —Ç–∞–±–ª–∏—Ü—É `note_images`
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–ª–æ–Ω–∫–∏ `created_at TEXT, updated_at TEXT` –≤ —Ç–∞–±–ª–∏—Ü—É `schedule_entries`
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å–∏—è –ë–î —Å 3 –¥–æ 4
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `_onUpgrade` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –±–∞–∑

```dart
Future<void> _onUpgrade(Database db, int oldVersion, int newVersion) async {
  if (oldVersion < 4) {
    // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏
    try {
      await db.execute('ALTER TABLE schedule_entries ADD COLUMN created_at TEXT');
      await db.execute('ALTER TABLE schedule_entries ADD COLUMN updated_at TEXT');
      await db.execute('ALTER TABLE note_images ADD COLUMN database_id TEXT');
    } catch (e) {
      print('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ö–µ–º—ã –ë–î: $e');
    }
  }
}
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –±–∞–∑ (`lib/providers/enhanced_collaborative_provider.dart`)

#### –ü—Ä–æ–±–ª–µ–º–∞
- –§–ª–∞–≥ `_isUsingSharedDatabase` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –ø–æ–∑–¥–Ω–æ
- –≠–∫—Ä–∞–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ "–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±–∞–∑—ã: –ª–æ–∫–∞–ª—å–Ω–æ–π" –≤ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ
- –ù–µ–ø–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

#### –†–µ—à–µ–Ω–∏–µ
```dart
Future<void> switchToDatabase(String databaseId) async {
  try {
    // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥–∏ –ù–ï–ú–ï–î–õ–ï–ù–ù–û
    _currentDatabaseId = databaseId;
    _isUsingSharedDatabase = true;
    
    // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    notifyListeners();
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º
    print('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º...');
    final personalBackup = await _databaseProvider!.createBackup(null);
    await _databaseProvider!.savePersonalBackup(personalBackup);
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
    await _dbHelper.clearCache();
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –±–∞–∑—ã
    await _databaseProvider!.initializeSharedDatabase(databaseId);
  } catch (e) {
    print('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ –±–∞–∑—É $databaseId: $e');
  }
}
```

### 3. –£–ª—É—á—à–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (`lib/services/enhanced_sync_service.dart`)

#### –ü—Ä–æ–±–ª–µ–º–∞
- FOREIGN KEY constraint failed –æ—à–∏–±–∫–∏
- –ü–æ—Ç–µ—Ä—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –î–≤–æ–π–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

#### –†–µ—à–µ–Ω–∏–µ
```dart
// –í–∞–ª–∏–¥–∞—Ü–∏—è folder_id –≤ –∑–∞–º–µ—Ç–∫–∞—Ö
if (folderId != null && folderId != 0) {
  final folderExists = await db.query('folders', 
    where: 'id = ? AND database_id = ?', 
    whereArgs: [folderId, _currentDatabaseId]);
  if (folderExists.isEmpty) {
    correctedNote['folder_id'] = null;
  }
}

// –í–∞–ª–∏–¥–∞—Ü–∏—è note_id –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö
final noteExists = await db.query('notes',
  where: 'id = ? AND database_id = ?',
  whereArgs: [noteId, _currentDatabaseId]);
if (noteExists.isEmpty) {
  print('–ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–º–µ—Ç–∫–∏: $noteId');
  continue;
}

// –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
if (_isSwitchingDatabase || _isSyncing) {
  print('–û–ø–µ—Ä–∞—Ü–∏—è —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é');
  return;
}
```

## –°—Ç–∞—Ç—É—Å
‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
‚úÖ –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω  
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞
‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω—ã

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –ª–∏—á–Ω–æ–π –∏ —Å–æ–≤–º–µ—Å—Ç–Ω—ã–º–∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö. 